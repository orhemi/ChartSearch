/**
 * Views manipulations.
 * Created by Tallevi12
 */

var mainJsonFile = {
    "Obsgroubs": [
        {
            "groupID": 1,
            "groupName": "Blood Cell Profile",
            "lastTakenDate": "12 May 2014",
            "observations": [
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                }
            ]
        },
        {
            "groupID": 2,
            "groupName": "Blood Cell Profile",
            "lastTakenDate": "12 May 2014",
            "observations": [
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                }
            ]
        },
        {
            "groupID": 3,
            "groupName": "Blood Cell Profile",
            "lastTakenDate": "12 May 2014",
            "observations": [
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                }
            ]
        },
        {
            "groupID": 4,
            "groupName": "Blood Cell Profile",
            "lastTakenDate": "12 May 2014",
            "observations": [
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                }
            ]
        },
        {
            "groupID": 5,
            "groupName": "Blood Cell Profile",
            "lastTakenDate": "12 May 2014",
            "observations": [
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                },
                {
                    "concept_name": "WBC",
                    "date": "12 May 2014",
                    "value_type": "type",
                    "value": 4.0,
                    "UnitsOfMeasurement": "k/cumm",
                    "minValue": 4.5,
                    "maxValue": 11,
                    "location": "Pharamcy"
                }
            ]
        }
    ]
};

var viewsFactory;
var doT;

viewsFactory = {

    result_row: doT.template('<div class="result_conainer"><div class="result_header">{{=it.head || \"\" }}</div><div class="result_body">{{=it.body || \"\" }}</div></div>')

}

function addAllObsGroups(obsJSON)
{
    var resultText='';
    var obsgroupJSON=obsJSON.Obsgroubs;
    for(var i=0;i<obsgroupJSON.length;i++){
        resultText+=addObsGroupToResults(obsgroupJSON[i]);
    }
    document.getElementById('obsgroups_results').innerHTML+=resultText;
}

function addObsGroupToResults(obsJSON)
{
    var resultText = '';
    resultText+='<div class="obsgroup_wrap" onclick="load_detailed_obs('+obsJSON.groupID+');">';
    resultText+='<div class="obsgroup_first_row">';
    resultText+='<h3 class="obsgroup_title">';
    resultText+=obsJSON.groupName;
    resultText+='</h3>';
    resultText+='<span class="obsgroup_date">';
    resultText+=obsJSON.lastTakenDate;
    resultText+='</span>'
    resultText+='<div class="chart_serach_clear"></div>';
    resultText+='</div>';
    resultText+=innerObservationsHTML(obsJSON.observations);
    resultText+='</div>';
    return resultText;
}

function innerObservationsHTML(obsJSON) {
    console.log('====innerObservationsHTML function======');
    var resultText='';
    resultText+='<div class="obsgroup_rows">';
    for(var i=0;i<obsJSON.length;i++){
        resultText+=single_obs_html(obsJSON[i]);
    }
    resultText+='</div>';
    return resultText;
}

function single_obs_html(obsJSON) {
    console.log('====single obs html function=========');
    var resultText='';
    resultText+='<div class="obsgroup_row">';
    resultText+='<div class="obsgroup_row_first_section inline">';
    resultText+=obsJSON.concept_name;
    resultText+='</div>';
    resultText+='<div class="obsgroup_row_sec_section inline">';
    resultText+=obsJSON.value + ' ' + obsJSON.UnitsOfMeasurement;
    resultText+='</div>';
    resultText+='<div class="obsgroup_row_trd_section inline">';
    resultText+='(' + obsJSON.minValue + ' - ' + obsJSON.maxValue + ')';
    resultText+='</div>';
    resultText+='</div>';
    return resultText;
}

function get_obs_by_id(id)
{
    var obsgroupJSON=mainJsonFile.Obsgroubs;
    for(var i=0;i<obsgroupJSON.length;i++){
        if(obsgroupJSON[i].groupID==id)
        {
            return obsgroupJSON[i];
        }
    }
    return -1;
}

function load_detailed_obs(obs_id)
{
    var obsJSON = get_obs_by_id(obs_id);
    var resultText='';
    resultText+='<div class="obsgroup_view">';
    resultText+='<h3 class="chartserach_center">';
    resultText+=obsJSON.groupName;
    resultText+='</h3>';
    resultText+='<div class="obsgroup_all_wrapper">';
    var singleObs = obsJSON.observations;
    for(var i=0;i<singleObs.length;i++){
        resultText+='<div class="obsgroup_item_row">';
        resultText+='<div class="obsgroup_item_first inline">';
        resultText+=singleObs[i].concept_name;
        resultText+='</div>';
        resultText+='<div class="obsgroup_item_sec inline">';
        resultText+=singleObs[i].value +" "+ singleObs[i].UnitsOfMeasurement;
        resultText+='</div>';
        resultText+='<div class="obsgroup_item_trd inline">';
        resultText+=singleObs[i].location;
        resultText+='</div>';
        resultText+='<div class="obsgroup_item_frth inline">';
        resultText+=singleObs[i].date;
        resultText+'</div>';
        resultText+='</div>';
    }
    resultText+='</div>';
    resultText+='</div>';
    document.getElementById('obsgroup_view').innerHTML=resultText;
}

jQuery( document ).ready(function() {
    addAllObsGroups(jsonAfterParse);
});


